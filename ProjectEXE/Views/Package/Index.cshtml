@model ProjectEXE.ViewModel.ServicePackages.ServicePackageListViewModel
@{
    ViewData["Title"] = "Chọn gói dịch vụ";
}

@section Styles {
    <link rel="stylesheet" href="~/css/service-packages.css?v=@DateTime.Now.Ticks">
}

<div class="service-packages-page">
    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <div class="header-content">
                <div class="header-title">
                    <h1>
                        <i class="fas fa-box-open"></i>
                        Chọn gói dịch vụ
                    </h1>
                    <p>Nâng cấp gian hàng của bạn với các gói dịch vụ chuyên nghiệp</p>
                </div>
                <div class="header-decoration">
                    <div class="floating-icons">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-crown"></i>
                        <i class="fas fa-bolt"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container main-content">
        <!-- Error Message -->
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger custom-alert fade-in" role="alert">
                <div class="alert-content">
                    <div class="alert-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="alert-text">
                        <strong>Có lỗi xảy ra!</strong>
                        <span>@TempData["ErrorMessage"]</span>
                    </div>
                    <button type="button" class="btn-close-custom" data-bs-dismiss="alert" aria-label="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        }

        <!-- Current Package Info -->
        @if (Model.CurrentPackageId.HasValue)
        {
            <div class="current-package-info fade-in">
                <div class="info-card">
                    <div class="info-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="info-content">
                        <h4>Gói dịch vụ hiện tại</h4>
                        <p>
                            Bạn đang sử dụng gói
                            <strong>@Model.Packages.FirstOrDefault(p => p.PackageId == Model.CurrentPackageId)?.PackageName</strong>
                            @if (Model.CurrentSubscriptionEndDate.HasValue)
                            {
                                <span>có hiệu lực đến <strong>@Model.CurrentSubscriptionEndDate.Value.ToString("dd/MM/yyyy")</strong></span>
                            }
                        </p>
                    </div>
                </div>
            </div>
        }

        <!-- Service Packages Grid -->
        <div class="packages-section">
            <div class="packages-grid">
                @for (int i = 0; i < Model.Packages.Count(); i++)
                {
                    var package = Model.Packages.ElementAt(i);
                    var isCurrentPackage = Model.CurrentPackageId == package.PackageId;
                    var isRecommended = i == 1; // Middle package as recommended

                    <div class="package-card @(isCurrentPackage ? "current-package" : "") @(isRecommended ? "recommended-package" : "")"
                         style="animation-delay: @(i * 0.2)s">

                        @if (isRecommended)
                        {
                            <div class="recommended-badge">
                                <i class="fas fa-star"></i>
                                <span>Phổ biến nhất</span>
                            </div>
                        }

                        @if (isCurrentPackage)
                        {
                            <div class="current-badge">
                                <i class="fas fa-check-circle"></i>
                                <span>Đang sử dụng</span>
                            </div>
                        }

                        <div class="package-header">
                            <div class="package-icon">
                                @if (i == 0)
                                {
                                    <i class="fas fa-seedling"></i>
                                }
                                else if (i == 1)
                                {
                                    <i class="fas fa-rocket"></i>
                                }
                                else
                                {
                                    <i class="fas fa-crown"></i>
                                }
                            </div>
                            <h3 class="package-name">@package.PackageName</h3>
                        </div>

                        <div class="package-pricing">
                            @if (package.DiscountedPrice.HasValue)
                            {
                                <div class="pricing-container">
                                    <div class="discounted-price">@package.DiscountedPrice.Value.ToString("N0")₫</div>
                                    <div class="original-price">@package.Price.ToString("N0")₫</div>
                                    <div class="discount-badge">
                                        -@Math.Round((decimal)(package.Price - package.DiscountedPrice.Value) / package.Price * 100)%
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="pricing-container">
                                    <div class="price">@package.Price.ToString("N0")₫</div>
                                </div>
                            }
                            <div class="price-duration">/ 30 ngày</div>
                        </div>

                        <div class="package-features">
                            <ul class="features-list">
                                <li class="feature-item">
                                    <div class="feature-icon">
                                        <i class="fas fa-box"></i>
                                    </div>
                                    <span>Tối đa <strong>@package.ProductLimit</strong> sản phẩm</span>
                                </li>
                                <li class="feature-item">
                                    <div class="feature-icon">
                                        <i class="fas fa-calendar-alt"></i>
                                    </div>
                                    <span>Thời hạn <strong>30</strong> ngày</span>
                                </li>
                                <li class="feature-item">
                                    <div class="feature-icon">
                                        <i class="fas fa-bolt"></i>
                                    </div>
                                    <span>Ưu tiên hiển thị</span>
                                </li>
                                <li class="feature-item">
                                    <div class="feature-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <span>Báo cáo thống kê</span>
                                </li>
                                @if (isRecommended)
                                {
                                    <li class="feature-item premium">
                                        <div class="feature-icon">
                                            <i class="fas fa-headset"></i>
                                        </div>
                                        <span>Hỗ trợ ưu tiên</span>
                                    </li>
                                }
                            </ul>
                        </div>

                        <div class="package-action">
                            <form asp-controller="Payment" asp-action="ProcessPayment" method="post">
                                <input type="hidden" name="packageId" value="@package.PackageId" />
                                <input type="hidden" name="paymentMethod" value="PayOs" />
                                <button type="submit" class="btn-select-package @(isCurrentPackage ? "btn-renew" : "btn-select")">
                                    @if (isCurrentPackage)
                                    {
                                        <i class="fas fa-sync-alt"></i>
                                        <span>Gia hạn gói</span>
                                    }
                                    else
                                    {
                                        <i class="fas fa-shopping-cart"></i>
                                        <span>Chọn gói này</span>
                                    }
                                </button>
                            </form>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Benefits Section -->
        <div class="benefits-section">
            <div class="section-header">
                <h2>
                    <i class="fas fa-gift"></i>
                    Tại sao nên nâng cấp gói dịch vụ?
                </h2>
                <p>Khám phá những lợi ích tuyệt vời khi sử dụng gói dịch vụ của chúng tôi</p>
            </div>

            <div class="benefits-grid">
                <div class="benefit-item">
                    <div class="benefit-icon">
                        <i class="fas fa-eye"></i>
                    </div>
                    <h4>Tăng khả năng hiển thị</h4>
                    <p>Sản phẩm của bạn sẽ được ưu tiên hiển thị ở vị trí cao hơn</p>
                </div>

                <div class="benefit-item">
                    <div class="benefit-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h4>Tiếp cận nhiều khách hàng</h4>
                    <p>Mở rộng phạm vi tiếp cận và thu hút thêm nhiều khách hàng tiềm năng</p>
                </div>

                <div class="benefit-item">
                    <div class="benefit-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <h4>Báo cáo chi tiết</h4>
                    <p>Theo dõi hiệu suất bán hàng với các báo cáo thống kê chuyên sâu</p>
                </div>

                <div class="benefit-item">
                    <div class="benefit-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h4>Độ tin cậy cao</h4>
                    <p>Gian hàng của bạn sẽ có dấu hiệu xác thực tăng độ tin cậy</p>
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div class="back-section">
            <a asp-controller="ShopProfile" asp-action="Index" class="btn-back">
                <i class="fas fa-arrow-left"></i>
                <span>Quay lại gian hàng</span>
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/service-packages.js?v=@DateTime.Now.Ticks"></script>
}